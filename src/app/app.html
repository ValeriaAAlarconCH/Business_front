<!-- Navegación -->
<nav>
  <a (click)="cambiarSeccion('formulario')" [class.active]="seccionActiva === 'formulario'">Formulario</a>
  <a (click)="cambiarSeccion('resultados')" [class.active]="seccionActiva === 'resultados'">Resultados</a>
  <a (click)="cambiarSeccion('tiposDiabetes')" [class.active]="seccionActiva === 'tiposDiabetes'">Tipos de Diabetes</a>
  <a (click)="cambiarSeccion('guiasCampos')" [class.active]="seccionActiva === 'guiasCampos'">Guías de Campos</a>
</nav>

<!-- Sección Formulario -->
<div *ngIf="seccionActiva === 'formulario'">
  <form #formEvaluacion (ngSubmit)="procesarFormulario()">
    <div *ngFor="let sec of secciones" class="seccion-formulario">
      <div class="seccion-titulo">
        <h3>{{sec.titulo}}</h3>
        <div class="seccion-linea"></div>
      </div>
      <div class="campos-seccion">
        <div *ngFor="let campo of campos | filterByIds:sec.campos" class="campo-formulario campo-{{campo.tipo}}">
          <label for="{{campo.id}}">
            {{campo.etiqueta}}
            <span class="requerido" *ngIf="campo.requerido">*</span>
          </label>
          <ng-container [ngSwitch]="campo.tipo">
            <select *ngSwitchCase="'select'" id="{{campo.id}}" name="{{campo.nombre}}" [(ngModel)]="formModel[campo.nombre]" [required]="campo.requerido">
              <option value="">Seleccione una opción</option>
              <option *ngFor="let opcion of opcionesSelect[campo.nombre]" [value]="opcion">{{opcion}}</option>
            </select>
            <input *ngSwitchCase="'number'" type="number" id="{{campo.id}}" name="{{campo.nombre}}" [(ngModel)]="formModel[campo.nombre]" [required]="campo.requerido" [min]="campo.min" [max]="campo.max" [step]="campo.paso" [placeholder]="campo.placeholder || ''">
            <input *ngSwitchDefault type="{{campo.tipo}}" id="{{campo.id}}" name="{{campo.nombre}}" [(ngModel)]="formModel[campo.nombre]" [required]="campo.requerido" [placeholder]="campo.placeholder || ''">
          </ng-container>
          <div class="ayuda-campo" [class.visible]="false">{{campo.ayuda}}</div> <!-- Agrega lógica para visibilidad si necesitas -->
        </div>
      </div>
    </div>
    <div class="contenedor-botones">
      <button type="submit" class="btn btn-primary btn-lg"><i class="icono-predict"></i> Realizar Predicción</button>
      <button type="button" class="btn btn-secondary btn-lg" (click)="limpiarFormulario()"><i class="icono-clear"></i> Limpiar Formulario</button>
      <button type="button" class="btn btn-outline btn-lg" (click)="cargarEjemplo()"><i class="icono-example"></i> Cargar Ejemplo</button>
    </div>
  </form>
</div>

<!-- Sección Resultados -->
<div *ngIf="seccionActiva === 'resultados' && resultado" class="resultado-container">
  <div class="resultado-header">
    <h2><i class="icono-result"></i> Resultado de la Predicción</h2>
    <div class="resultado-fecha">{{formatFecha(resultado.fechaPrediccion)}}</div>
  </div>
  <div class="resultado-principal">
    <div class="diagnostico-card">
      <div class="diagnostico-tipo">
        <h3>{{resultado.tipoDiabetesEs}}</h3>
        <div class="diagnostico-original">{{resultado.tipoDiabetes}}</div>
      </div>
      <div class="diagnostico-probabilidad">
        <div class="probabilidad-valor">{{formatPorcentaje(resultado.probabilidad)}}</div>
        <div class="probabilidad-barra">
          <div class="probabilidad-progreso" [style.width.%]="resultado.probabilidad * 100"></div>
        </div>
        <div class="probabilidad-texto">Confianza de predicción</div>
      </div>
    </div>
    <div class="resultado-explicacion">
      <h4><i class="icono-explanation"></i> Explicación</h4>
      <div class="explicacion-texto" [innerHTML]="resultado.explicacion | newlineToBr"></div>
    </div>
    <div class="clasificaciones-grid">
      <h4><i class="icono-classification"></i> Clasificación de Valores</h4>
      <div class="grid-container">
        <div *ngFor="let item of resultado.clasificaciones | keyvalue" class="clasificacion-item">
          <div class="clasificacion-icono"><i [class]="getIcono(item.value)"></i></div>
          <div class="clasificacion-info">
            <div class="clasificacion-nombre">{{getNombreClasificacion(item.key)}}</div>
            <div class="clasificacion-valor {{item.value.toLowerCase()}}">{{item.value}}</div>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="resultado.informacionTipo" class="tipo-diabetes-info">
      <h4><i class="icono-info"></i> Información sobre {{resultado.informacionTipo.nombreEs}}</h4>
      <div class="info-grid">
        <div class="info-item">
          <h5><i class="icono-description"></i> Descripción</h5>
          <p>{{resultado.informacionTipo.descripcion}}</p>
        </div>
        <div class="info-item" *ngIf="resultado.informacionTipo.causas">
          <h5><i class="icono-causes"></i> Causas Principales</h5>
          <p>{{resultado.informacionTipo.causas}}</p>
        </div>
        <!-- Agrega secciones similares para sintomas, tratamiento, recomendaciones -->
      </div>
    </div>
    <div class="resultado-recomendaciones">
      <h4><i class="icono-recommendation"></i> Recomendaciones</h4>
      <div class="recomendaciones-texto" [innerHTML]="resultado.recomendacionesPersonalizadas | newlineToBr"></div>
    </div>
  </div>
  <div class="resultado-acciones">
    <button class="btn btn-secondary" (click)="cambiarSeccion('formulario')"><i class="icono-new"></i> Nueva Predicción</button>
    <button class="btn btn-outline" (click)="imprimir()"><i class="icono-print"></i> Imprimir Resultado</button>
    <button class="btn btn-outline" (click)="guardarPDF()"><i class="icono-pdf"></i> Guardar como PDF</button>
  </div>
</div>

<!-- Sección Tipos de Diabetes -->
<div *ngIf="seccionActiva === 'tiposDiabetes'" id="listaTiposDiabetes">
  <div *ngFor="let tipo of tiposDiabetes" class="tipo-diabetes-card" [class.comun]="tipo.esComun" [class.raro]="!tipo.esComun">
    <div class="tipo-header">
      <h4>{{tipo.nombreEs}}</h4>
      <span class="tipo-original">{{tipo.nombreEn}}</span>
    </div>
    <div class="tipo-descripcion">{{tipo.descripcion.substring(0, 150)}}...</div>
    <button class="btn-detalles" (click)="mostrarDetallesTipo(tipo)">Ver detalles completos</button>
  </div>
</div>

<!-- Sección Guías de Campos -->
<div *ngIf="seccionActiva === 'guiasCampos'" id="listaGuiasCampos">
  <div *ngFor="let guia of guiasCampos" class="guia-campo-card">
    <div class="guia-header">
      <h4>{{guia.tituloEs}}</h4>
      <span class="guia-campo">{{guia.nombreCampo}}</span>
    </div>
    <div class="guia-descripcion">{{guia.descripcionEs}}</div>
    <div class="guia-detalles">
      <div class="detalle-item">
        <span class="detalle-label">Ejemplos:</span>
        <span class="detalle-valor">{{guia.ejemplos}}</span>
      </div>
      <div class="detalle-item">
        <span class="detalle-label">Rango recomendado:</span>
        <span class="detalle-valor">{{guia.rangoRecomendado}}</span>
      </div>
      <div class="detalle-item">
        <span class="detalle-label">Unidad de medida:</span>
        <span class="detalle-valor">{{guia.unidadMedida}}</span>
      </div>
    </div>
  </div>
</div>

<!-- Modal para Detalles de Tipo Diabetes -->
<div *ngIf="showModal && selectedTipo" class="modal-overlay" (click)="cerrarModal()">
  <div class="modal-contenido" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{selectedTipo.nombreEs}}</h3>
      <button class="modal-cerrar" (click)="cerrarModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="modal-seccion">
        <h4>Descripción</h4>
        <p>{{selectedTipo.descripcion}}</p>
      </div>
      <div class="modal-seccion" *ngIf="selectedTipo.causas">
        <h4>Causas</h4>
        <p>{{selectedTipo.causas}}</p>
      </div>
      <!-- Agrega secciones para sintomas, tratamiento, recomendaciones -->
      <div class="modal-seccion">
        <div class="tipo-metadata">
          <span class="metadata-item" [class.comun]="selectedTipo.esComun" [class.raro]="!selectedTipo.esComun">
            {{selectedTipo.esComun ? 'Común' : 'Poco común'}}
          </span>
          <span class="metadata-item">ID: {{selectedTipo.idTipoDiabetes}}</span>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary modal-cerrar" (click)="cerrarModal()">Cerrar</button>
    </div>
  </div>
</div>
